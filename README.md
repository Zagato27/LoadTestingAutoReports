# Автоматическое создание отчётов в Confluence

Инструмент для автоматизации публикации результатов нагрузочного тестирования: сбор метрик/логов, AI‑аналитика и обновление страницы Confluence по шаблону.

## Что делает
- Скачивает графики из Grafana и прикрепляет логи из Loki.
- Выполняет AI‑анализ по доменам (JVM/Database/Kafka/Microservices) и общий итог.
- Заполняет плейсхолдеры шаблона Confluence за один проход (атомарно), пропуская отсутствующие данные.

## Плейсхолдеры (шаблон Confluence)
- Метрики: `$$<name>$$` из `metrics_config.py` → изображения панелей.
- Логи: `$$<placeholder>$$` из `metrics_config.py.logs` → виджет с вложением.
- AI‑аналитика (markdown):
  - `$$answer_jvm$$`, `$$answer_database$$`, `$$answer_kafka$$`, `$$answer_ms$$` — доменные блоки.
  - `$$final_answer$$` — сводный текст.
  - `$$answer_llm$$` — итог LLM в едином markdown‑виде (вердикт/уверенность/findings/actions).

## Конфигурация
- `config.py` — доступы к Confluence/Grafana/Loki.
- `metrics_config.py` — сервисы, шаблон/папка, список метрик и логов.
- `AI/config.py` — параметры AI (модель, сеть, время запросов, генерация и т.д.).

## Запуск
1) Установите зависимости:
```bash
pip install -r requirements.txt
```
2) Заполните `config.py`, `metrics_config.py`, `AI/config.py`.
3) Запустите веб‑приложение:
```bash
python app.py
```
4) Откройте форму по адресу из консоли и создайте отчёт (или вызовите POST `/create_report`).

## Особенности
- Мульти‑обновление Confluence за один запрос, защита от конфликтов версий.
- Пропуски данных не ломают отчёт — отсутствующие плейсхолдеры/значения игнорируются.
- AI‑часть формирует компактный контекст, валидируется по строгой схеме и рендерится в markdown.

